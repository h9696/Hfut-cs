### 设计9 WEB服务器设计与实现

#### 设计目的

1. **熟悉开发工具（Visual Studio、C/C++、Java 等）的基本操作**：
   - **工具选择**：使用Java作为开发语言，通过Eclipse、IntelliJ IDEA等IDE进行开发。
   - **操作**：熟练掌握Java开发环境的配置、项目的创建与运行。

2. **掌握HTTP协议的工作原理**：
   - **解析HTTP请求**：在`ClientHandler`类中读取并解析HTTP请求行、头部和主体。
   - **生成HTTP响应**：根据请求结果（文件存在与否、请求方法）生成相应的HTTP响应头和主体。

3. **掌握多线程编程**：
   - **线程池**：在`SimpleWebServer`类中使用`ExecutorService`创建固定大小的线程池来处理并发请求。
   - **并发处理**：每个客户端请求由一个线程处理，通过`ClientHandler`类实现。

4. **对于Socket编程建立初步的概念**：
   - **Socket通信**：使用`ServerSocket`监听端口，接受客户端连接并通过`Socket`进行通信。
   - **I/O流**：使用输入流和输出流进行数据传输，读取请求和发送响应。

5. **掌握对文件的网络传输操作**：
   - **文件读取**：在`ClientHandler`类中使用`Files.readAllBytes`方法读取文件内容。
   - **文件传输**：将文件内容通过`OutputStream`发送给客户端。

#### 设计要求

1. **不限平台，熟悉 Socket API 主要函数的使用**：
   - **跨平台性**：Java的Socket API是跨平台的，代码可以在任何支持Java的平台上运行。
   - **Socket API使用**：`ServerSocket`用于服务器端监听端口，`Socket`用于客户端连接，`InputStream`和`OutputStream`用于数据传输。

2. **实现一个简单的基于HTTP协议的WEB服务器**：
   - **请求解析与响应**：服务器能够接受客户端的HTTP请求，解析请求行并根据请求的资源路径返回相应的文件内容或错误信息。

3. **实现对服务器运行状态的监控**：
   - **日志记录**：使用Java的`Logger`类记录服务器运行状态及错误信息，通过配置文件设置日志级别。

#### 设计内容

1. **处理HTTP请求**：
   - **请求应答**：在`ClientHandler`类中读取HTTP请求，解析请求行和请求方法（GET、HEAD、POST），根据请求的文件路径返回文件内容或错误信息。
   - **静态网页文件**：服务器端查询文件路径下是否存在请求的网页文件（如html、htm文件），存在则传递文件，不存在则返回404错误。

2. **不涉及动态网页的解析**：
   - **静态网页处理**：服务器只处理静态网页文件的请求，不涉及动态网页的解析（如.asp、.aspx、.php、.jsp等）。

3. **多客户端访问问题**：
   - **多线程机制**：使用线程池（`ExecutorService`）处理并发客户端请求，每个请求由一个线程处理，保证服务器能够同时处理多个客户端连接。

#### 额外功能及实现

1. **缓存机制**：
   - **功能**：缓存文件内容以提高读取效率。
   - **实现**：`SimpleCache`类通过`LinkedHashMap`实现一个简单的LRU（Least Recently Used）缓存机制，限制缓存大小为100个文件。

2. **日志记录**：
   - **功能**：记录服务器运行状态及错误信息。
   - **实现**：使用Java的`Logger`类进行日志记录，通过配置文件设置日志级别。

3. **支持多种请求方法**：
   - **功能**：支持GET、HEAD、POST请求方法。
   - **实现**：
     - `GET`请求：读取文件内容并返回。
     - `HEAD`请求：只返回响应头部，不返回文件内容。
     - `POST`请求：读取请求体并返回响应（示例中未实际处理请求体）。

4. **MIME类型支持**：
   - **功能**：根据文件扩展名设置正确的Content-Type。
   - **实现**：使用一个`Map`将文件扩展名映射到对应的MIME类型。

#### 服务器的工作模式

1. **工作模式**：该服务器采用多线程的工作模式，使用线程池处理多个客户端的并发请求。
   - **主线程**：在`SimpleWebServer`类中启动，监听端口并接受客户端连接。
   - **工作线程**：每个客户端请求由线程池中的一个线程处理，`ClientHandler`类负责处理具体的请求逻辑。

2. **测试方法**：
   - **浏览器测试**：使用浏览器访问服务器，测试对不同文件的请求，以及对不存在文件的请求。
   - **工具测试**：使用Postman等工具发送不同的HTTP请求，验证服务器对GET、HEAD、POST请求的处理。

3. **性能优化**：
   - **缓存机制**：使用`SimpleCache`类缓存文件内容，减少文件读取次数。
   - **线程池管理**：调整线程池大小，优化并发请求处理。
   - **配置文件**：通过配置文件灵活调整服务器参数（如端口号、线程池大小、日志级别），提高灵活性和适应性。

### 总结

该项目通过实现一个简单的基于HTTP协议的WEB服务器，使学生掌握了HTTP协议、多线程编程、Socket编程以及文件传输的基本概念和技能，并在此基础上增加了缓存机制、日志记录等功能，提高了服务器的性能和可维护性。